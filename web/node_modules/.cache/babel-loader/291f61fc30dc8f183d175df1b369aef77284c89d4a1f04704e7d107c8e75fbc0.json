{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import styled from'styled-components';import{FaSync,FaSignOutAlt,FaUser,FaRobot,FaUsers,FaBroadcastTower}from'react-icons/fa';import{useAuth}from'../hooks/useAuth';import ConversationList from'../components/ConversationList';import ChatView from'../components/ChatView';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MainContainer=styled.div`\n  display: flex;\n  height: 100vh;\n  background: white;\n`;const Sidebar=styled.div`\n  width: 350px;\n  background: #f8f9fa;\n  border-right: 1px solid #e0e0e0;\n  display: flex;\n  flex-direction: column;\n`;const SidebarHeader=styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #e0e0e0;\n  background: white;\n`;const Title=styled.h2`\n  color: #333;\n  margin-bottom: 15px;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n`;const ButtonGroup=styled.div`\n  display: flex;\n  gap: 10px;\n`;const ActionButton=styled.button`\n  padding: 8px 16px;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 14px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  transition: all 0.3s ease;\n  \n  &.sync {\n    background: #28a745;\n    color: white;\n    \n    &:hover {\n      background: #218838;\n    }\n  }\n  \n  &.logout {\n    background: #dc3545;\n    color: white;\n    \n    &:hover {\n      background: #c82333;\n    }\n  }\n  \n  &:disabled {\n    background: #ccc;\n    cursor: not-allowed;\n  }\n`;const ChatContainer=styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n`;const EmptyState=styled.div`\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #666;\n  font-size: 18px;\n`;const StatusBar=styled.div`\n  padding: 10px 20px;\n  background: #e9ecef;\n  border-top: 1px solid #dee2e6;\n  font-size: 14px;\n  color: #666;\n`;const MainPage=()=>{const[conversations,setConversations]=useState([]);const[selectedConversation,setSelectedConversation]=useState(null);const[loading,setLoading]=useState(true);const[syncing,setSyncing]=useState(false);const[syncStatus,setSyncStatus]=useState({totalConversations:0,totalMessages:0,lastSyncTime:null});const{isAuthenticated,logout}=useAuth();const navigate=useNavigate();useEffect(()=>{if(!isAuthenticated){navigate('/');return;}loadConversations();},[isAuthenticated,navigate]);const loadConversations=async()=>{try{const response=await axios.get('/api/v1/conversations');setConversations(response.data.conversations||[]);setSyncStatus(prev=>{var _response$data$conver;return{...prev,totalConversations:((_response$data$conver=response.data.conversations)===null||_response$data$conver===void 0?void 0:_response$data$conver.length)||0};});}catch(error){console.error('Failed to load conversations:',error);}finally{setLoading(false);}};const handleSync=async()=>{setSyncing(true);try{const response=await axios.post('/api/v1/sync');if(response.data.success){// 重新加载会话列表\nsetTimeout(()=>{loadConversations();},2000);}}catch(error){console.error('Sync failed:',error);}finally{setSyncing(false);}};const handleLogout=()=>{logout();navigate('/');};const getConversationIcon=type=>{switch(type){case'user':return/*#__PURE__*/_jsx(FaUser,{});case'bot':return/*#__PURE__*/_jsx(FaRobot,{});case'group':return/*#__PURE__*/_jsx(FaUsers,{});case'channel':return/*#__PURE__*/_jsx(FaBroadcastTower,{});default:return/*#__PURE__*/_jsx(FaUser,{});}};if(loading){return/*#__PURE__*/_jsx(MainContainer,{children:/*#__PURE__*/_jsx(\"div\",{style:{flex:1,display:'flex',alignItems:'center',justifyContent:'center'},children:/*#__PURE__*/_jsx(\"div\",{children:\"\\u52A0\\u8F7D\\u4E2D...\"})})});}return/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsxs(Sidebar,{children:[/*#__PURE__*/_jsxs(SidebarHeader,{children:[/*#__PURE__*/_jsxs(Title,{children:[/*#__PURE__*/_jsx(FaBroadcastTower,{color:\"#0088cc\"}),\"\\u4F1A\\u8BDD\\u5217\\u8868\"]}),/*#__PURE__*/_jsxs(ButtonGroup,{children:[/*#__PURE__*/_jsxs(ActionButton,{className:\"sync\",onClick:handleSync,disabled:syncing,children:[/*#__PURE__*/_jsx(FaSync,{className:syncing?'spin':''}),syncing?'同步中...':'同步']}),/*#__PURE__*/_jsxs(ActionButton,{className:\"logout\",onClick:handleLogout,children:[/*#__PURE__*/_jsx(FaSignOutAlt,{}),\"\\u9000\\u51FA\"]})]})]}),/*#__PURE__*/_jsx(ConversationList,{conversations:conversations,selectedConversation:selectedConversation,onSelectConversation:setSelectedConversation,getConversationIcon:getConversationIcon})]}),/*#__PURE__*/_jsx(ChatContainer,{children:selectedConversation?/*#__PURE__*/_jsx(ChatView,{conversation:selectedConversation}):/*#__PURE__*/_jsx(EmptyState,{children:\"\\u8BF7\\u9009\\u62E9\\u4E00\\u4E2A\\u4F1A\\u8BDD\\u67E5\\u770B\\u804A\\u5929\\u8BB0\\u5F55\"})}),/*#__PURE__*/_jsxs(StatusBar,{children:[\"\\u4F1A\\u8BDD\\u6570: \",syncStatus.totalConversations,\" | \\u6D88\\u606F\\u6570: \",syncStatus.totalMessages,syncStatus.lastSyncTime&&` | 最后同步: ${new Date(syncStatus.lastSyncTime).toLocaleString()}`]})]});};export default MainPage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","styled","FaSync","FaSignOutAlt","FaUser","FaRobot","FaUsers","FaBroadcastTower","useAuth","ConversationList","ChatView","axios","jsx","_jsx","jsxs","_jsxs","MainContainer","div","Sidebar","SidebarHeader","Title","h2","ButtonGroup","ActionButton","button","ChatContainer","EmptyState","StatusBar","MainPage","conversations","setConversations","selectedConversation","setSelectedConversation","loading","setLoading","syncing","setSyncing","syncStatus","setSyncStatus","totalConversations","totalMessages","lastSyncTime","isAuthenticated","logout","navigate","loadConversations","response","get","data","prev","_response$data$conver","length","error","console","handleSync","post","success","setTimeout","handleLogout","getConversationIcon","type","children","style","flex","display","alignItems","justifyContent","color","className","onClick","disabled","onSelectConversation","conversation","Date","toLocaleString"],"sources":["/Users/zhangshijie/Documents/web3Task/tgBackup/web/src/pages/MainPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport styled from 'styled-components';\nimport { FaSync, FaSignOutAlt, FaUser, FaRobot, FaUsers, FaBroadcastTower } from 'react-icons/fa';\nimport { useAuth } from '../hooks/useAuth';\nimport ConversationList from '../components/ConversationList';\nimport ChatView from '../components/ChatView';\nimport axios from 'axios';\n\nconst MainContainer = styled.div`\n  display: flex;\n  height: 100vh;\n  background: white;\n`;\n\nconst Sidebar = styled.div`\n  width: 350px;\n  background: #f8f9fa;\n  border-right: 1px solid #e0e0e0;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst SidebarHeader = styled.div`\n  padding: 20px;\n  border-bottom: 1px solid #e0e0e0;\n  background: white;\n`;\n\nconst Title = styled.h2`\n  color: #333;\n  margin-bottom: 15px;\n  display: flex;\n  align-items: center;\n  gap: 10px;\n`;\n\nconst ButtonGroup = styled.div`\n  display: flex;\n  gap: 10px;\n`;\n\nconst ActionButton = styled.button`\n  padding: 8px 16px;\n  border: none;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 14px;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  transition: all 0.3s ease;\n  \n  &.sync {\n    background: #28a745;\n    color: white;\n    \n    &:hover {\n      background: #218838;\n    }\n  }\n  \n  &.logout {\n    background: #dc3545;\n    color: white;\n    \n    &:hover {\n      background: #c82333;\n    }\n  }\n  \n  &:disabled {\n    background: #ccc;\n    cursor: not-allowed;\n  }\n`;\n\nconst ChatContainer = styled.div`\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n`;\n\nconst EmptyState = styled.div`\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #666;\n  font-size: 18px;\n`;\n\nconst StatusBar = styled.div`\n  padding: 10px 20px;\n  background: #e9ecef;\n  border-top: 1px solid #dee2e6;\n  font-size: 14px;\n  color: #666;\n`;\n\nconst MainPage = () => {\n  const [conversations, setConversations] = useState([]);\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [syncing, setSyncing] = useState(false);\n  const [syncStatus, setSyncStatus] = useState({\n    totalConversations: 0,\n    totalMessages: 0,\n    lastSyncTime: null\n  });\n\n  const { isAuthenticated, logout } = useAuth();\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      navigate('/');\n      return;\n    }\n    \n    loadConversations();\n  }, [isAuthenticated, navigate]);\n\n  const loadConversations = async () => {\n    try {\n      const response = await axios.get('/api/v1/conversations');\n      setConversations(response.data.conversations || []);\n      setSyncStatus(prev => ({\n        ...prev,\n        totalConversations: response.data.conversations?.length || 0\n      }));\n    } catch (error) {\n      console.error('Failed to load conversations:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSync = async () => {\n    setSyncing(true);\n    try {\n      const response = await axios.post('/api/v1/sync');\n      if (response.data.success) {\n        // 重新加载会话列表\n        setTimeout(() => {\n          loadConversations();\n        }, 2000);\n      }\n    } catch (error) {\n      console.error('Sync failed:', error);\n    } finally {\n      setSyncing(false);\n    }\n  };\n\n  const handleLogout = () => {\n    logout();\n    navigate('/');\n  };\n\n  const getConversationIcon = (type) => {\n    switch (type) {\n      case 'user':\n        return <FaUser />;\n      case 'bot':\n        return <FaRobot />;\n      case 'group':\n        return <FaUsers />;\n      case 'channel':\n        return <FaBroadcastTower />;\n      default:\n        return <FaUser />;\n    }\n  };\n\n  if (loading) {\n    return (\n      <MainContainer>\n        <div style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\n          <div>加载中...</div>\n        </div>\n      </MainContainer>\n    );\n  }\n\n  return (\n    <MainContainer>\n      <Sidebar>\n        <SidebarHeader>\n          <Title>\n            <FaBroadcastTower color=\"#0088cc\" />\n            会话列表\n          </Title>\n          <ButtonGroup>\n            <ActionButton \n              className=\"sync\" \n              onClick={handleSync} \n              disabled={syncing}\n            >\n              <FaSync className={syncing ? 'spin' : ''} />\n              {syncing ? '同步中...' : '同步'}\n            </ActionButton>\n            <ActionButton className=\"logout\" onClick={handleLogout}>\n              <FaSignOutAlt />\n              退出\n            </ActionButton>\n          </ButtonGroup>\n        </SidebarHeader>\n        \n        <ConversationList \n          conversations={conversations}\n          selectedConversation={selectedConversation}\n          onSelectConversation={setSelectedConversation}\n          getConversationIcon={getConversationIcon}\n        />\n      </Sidebar>\n\n      <ChatContainer>\n        {selectedConversation ? (\n          <ChatView conversation={selectedConversation} />\n        ) : (\n          <EmptyState>\n            请选择一个会话查看聊天记录\n          </EmptyState>\n        )}\n      </ChatContainer>\n\n      <StatusBar>\n        会话数: {syncStatus.totalConversations} | 消息数: {syncStatus.totalMessages}\n        {syncStatus.lastSyncTime && ` | 最后同步: ${new Date(syncStatus.lastSyncTime).toLocaleString()}`}\n      </StatusBar>\n    </MainContainer>\n  );\n};\n\nexport default MainPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}